MultiScaleModel.generate do

model :my_multi_model do

       type :muscleapp
       #type :composite
       
model :submodelA do
       
        type :musclekernel
        
        
	%do zmiany type scaleful implemenation_type :musclekernel

	language :java

	timescale :delta=>10, :max=>100

	execution do

		declare :double_array, :velocity, 5


		loop :start_time=>0, :stop_time=>10, :step_time=>1 do


  			execute "
                        System.out.println(\"Sending velocity values\");
  			for(int i=0; i<velocity.length; i++){
    			velocity[i]=4;
  			}
  			"
  			send :velocity

		end
                execute "
                 System.out.println(\"The end\");
                "
	end

end

model :submodelB do

	type :musclekernel


	language :java

	timescale :delta=>10, :max=>100

	execution do

	declare :double_array, :velocity


	loop :start_time=>0, :stop_time=>10, :step_time=>1 do

  		receive :velocity

  		execute "
                        System.out.println(\"Receiving velocity values\");
  			for(int i=0; i<velocity.length; i++){
    			System.out.println(velocity[i]);
  		}
  		"
	end
        execute "
                 System.out.println(\"The end\");
        "

	end

end



execution  do

    instance  :modA, :submodelA, :domainA
    instance  :modB, :submodelB, :domainA

    join :modA, :modB  do 
	tie :velocity, :velocity
    end
    join :my_port :modB do
        tie :velocity, :velocity
    end
end

end # my_multi_model


end #generate


